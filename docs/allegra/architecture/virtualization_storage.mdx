---
title: Virtualization and Storage
id: virtualization_storage
slug: /allegra/virtualization_storage
description: ""
tags: ['Allegra', 'Web3', 'cloud platform', 'dApps', 'decentralization']
---

import ImageComponent from '@site/src/components/Media/ImageComponent';
import Image from '@site/src/components/Media/Image';
import Accordion from '@site/src/components/Accordion/Accordion';

# Virtualization and Storage: The Workhorses

The **Virtualization and Storage** layer in Allegraâ€™s architecture is where the actual computation and data storage occur. By combining advanced virtualization technologies with a robust distributed storage system, this layer ensures that Allegra delivers a high-performance, scalable, and resilient cloud platform for developers and businesses alike.

## Key Components of the Virtualization and Storage Layer

The Virtualization and Storage layer consists of several key components that work together to manage compute workloads and storage requirements:

### 1. **Virtualization Layer**

The Virtualization Layer enables Allegra to support a wide range of workloads by using different virtualization technologies. This layer is designed to maximize resource efficiency and flexibility, allowing developers to choose the most suitable environment for their applications.

- **KVM (Kernel-based Virtual Machine)**: Provides full virtualization support. Allows multiple operating systems to run independently on the same physical machine, enabling the hosting of various applications in isolated environments.

- **Docker**: Supports containerization. Offers a lightweight virtualization solution for deploying applications in containers. Docker containers are ideal for microservices and applications that require rapid scaling, as they consume fewer resources than traditional VMs.

- **LXD/LXC**: Enables lightweight system containers. Provides an alternative to full virtualization by running multiple isolated Linux systems (containers) on a single host. LXD/LXC containers are efficient for workloads that need to be quickly scaled or deployed.

### 2. **Storage Layer**

The Storage Layer is responsible for managing all data storage needs, ensuring data redundancy, high availability, and fast access. It leverages a distributed architecture to provide robust and reliable storage for all types of applications.

- **mtnFS (Merkle-Tree Network File System)**: A POSIX-compliant, Merkle-Tree-backed network filesystem. Ensures data integrity and efficient storage across a distributed network by using Merkle Trees to verify and synchronize data changes. This system is designed for high-performance data access and redundancy.

- **Block Storage Devices**: Provides storage for virtual machine (VM) data. Supports traditional block storage for VM instances, ensuring that all data written to the disk is secure and available. This is critical for applications that require persistent storage.

- **Cloud-Init**: Automates instance initialization. Automates the initialization of cloud instances by setting up the necessary environment, configuring network settings, and preparing storage resources for new instances.

#### How Allegra Prepares Storage for a New Instance

Allegra's process ensures that each instance has its own isolated storage, while still benefiting from the distributed nature of the system.

<Accordion title="How Allegra prepares storage for a new instance">
```python
async def prepare_disk_image(source, raw_tmp_dest, use_from, namespace):
    # Copy the original disk image
    await copy_disk_image(source, use_from)

    # Convert the disk image to mtnFS format
    await convert_disk_image(use_from, "mtnfs")
```
</Accordion>

<Image src="img/allegra/storage-light.png" srcDark="img/allegra/storage-dark.png"/>

## How the Virtualization and Storage Layer Works

1. **Compute Workloads with Virtualization Technologies**: The Virtualization Layer provides a flexible environment for running various workloads, from fully virtualized VMs using KVM to lightweight containers using Docker and LXD/LXC. This flexibility allows developers to choose the most efficient deployment model for their applications.

2. **Distributed Data Storage with mtnFS**: The Merkle-Tree-backed Network File System (mtnFS) ensures that data is stored redundantly across the network, allowing for high availability and quick access. The use of Merkle Trees enables efficient synchronization and verification of data changes, enhancing both performance and security.

3. **Persistent Storage with Block Devices**: Block storage devices offer reliable and persistent storage for VM instances, ensuring that data is securely stored and readily accessible. This is essential for applications that require constant access to large amounts of data.

4. **Automated Instance Initialization with Cloud-Init**: The Cloud-Init component streamlines the setup and configuration of new instances, ensuring they are ready for deployment in minimal time. It handles tasks such as configuring network settings, preparing storage, and installing necessary software.

## Benefits of the Virtualization and Storage Layer

- **Enhanced Flexibility and Efficiency**: Supports multiple virtualization technologies, allowing developers to choose the most suitable environment for their needs.
- **Data Redundancy and High Availability**: Ensures data is always available and protected from loss or corruption through distributed storage and redundancy mechanisms.
- **Optimized Resource Utilization**: Uses efficient storage and virtualization technologies to minimize resource consumption while maximizing performance.
- **Rapid Deployment and Scalability**: Facilitates the quick deployment of new instances and the scaling of resources to meet changing workloads.
